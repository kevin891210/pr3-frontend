# 薪資計算與請假管理整合功能

## 功能概述

在薪資計算的 "Add Calculation" 功能中，現在可以自動從請假管理系統中計算缺勤天數，無需手動輸入。

## 整合特性

### 1. 自動計算缺勤天數
- 在薪資計算表單中，缺勤天數欄位旁新增「自動計算」按鈕
- 點擊按鈕後，系統會自動查詢該員工在計算期間內的已批准請假記錄
- 自動計算重疊天數並填入缺勤天數欄位

### 2. 智能日期重疊計算
- 系統會計算請假日期與薪資計算期間的重疊部分
- 只計算實際影響薪資計算期間的請假天數
- 支援跨期間的請假記錄處理

### 3. 即時反饋
- 計算完成後顯示詳細資訊：計算出的天數和來源請假記錄數量
- 如果期間內沒有已批准的請假記錄，會顯示相應提示
- 計算失敗時會顯示錯誤訊息

## 使用方式

### 步驟 1：選擇員工和期間
1. 在薪資計算表單中選擇員工
2. 設定計算開始日期和結束日期

### 步驟 2：自動計算缺勤天數
1. 點擊缺勤天數欄位旁的「自動計算」按鈕（帶日曆圖標）
2. 系統會自動查詢並計算缺勤天數
3. 計算結果會自動填入缺勤天數欄位

### 步驟 3：查看扣款預覽
- 系統會根據計算出的缺勤天數自動顯示扣款金額
- 扣款計算公式：(基本薪資 / 30) × 缺勤天數

## 技術實現

### API 整合
```javascript
// 新增的 API 方法
async getLeaveRequestsByDateRange(memberId, startDate, endDate, status = null)
```

### 計算邏輯
```javascript
// 日期重疊計算
const overlapStart = new Date(Math.max(leaveStart.getTime(), periodStart.getTime()));
const overlapEnd = new Date(Math.min(leaveEnd.getTime(), periodEnd.getTime()));

if (overlapStart <= overlapEnd) {
  const days = Math.ceil((overlapEnd - overlapStart) / (1000 * 60 * 60 * 24)) + 1;
  return total + days;
}
```

## 多語系支援

功能支援中英日三語：
- 中文：「自動計算」
- 英文：「Auto Calculate」  
- 日文：「自動計算」

## 使用場景

### 場景 1：月薪計算
員工在當月有 3 天年假，系統會自動計算這 3 天作為缺勤天數，並計算相應的薪資扣除。

### 場景 2：跨期間請假
員工請假從月底跨到下個月初，系統只會計算落在薪資計算期間內的天數。

### 場景 3：多筆請假記錄
員工在計算期間內有多筆已批准的請假，系統會累計所有相關的請假天數。

## 優勢

1. **提高效率**：無需手動查詢和計算請假天數
2. **減少錯誤**：自動化計算避免人為計算錯誤
3. **數據一致性**：直接從請假管理系統獲取準確數據
4. **用戶友好**：簡單的一鍵操作，即時反饋結果

## 注意事項

- 只會計算狀態為「已批准」的請假記錄
- 需要先選擇員工和設定計算期間才能使用自動計算功能
- 計算結果可以手動調整，系統不會覆蓋手動輸入的值
- 如果 API 調用失敗，會顯示錯誤訊息並保持原有的缺勤天數值

## 未來擴展

可以考慮的功能擴展：
1. 支援不同請假類型的差異化處理
2. 加入請假類型對薪資影響的配置
3. 支援半天請假的精確計算
4. 加入請假記錄的詳細顯示和確認機制